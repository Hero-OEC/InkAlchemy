# StoryForge - Worldbuilding Management Platform

## Overview

StoryForge is a comprehensive worldbuilding and story management platform designed for writers and creators. It provides tools to organize characters, locations, timelines, magic systems, lore, and notes within structured projects. The application uses a modern full-stack architecture with a React frontend and Express backend, leveraging PostgreSQL for data persistence.

## User Preferences

Preferred communication style: Simple, everyday language.
Typography: Cairo font for entire application with full weight range (200-900).
Design approach: Light mode only, custom brand color palette, offline-first architecture.

## System Architecture

### Frontend Architecture
- **Framework**: React 18 with TypeScript
- **Build Tool**: Vite for development and production builds
- **UI Library**: Shadcn/ui components built on Radix UI primitives
- **Styling**: Tailwind CSS with CSS variables for theming
- **State Management**: TanStack Query (React Query) for server state management
- **Routing**: Wouter for lightweight client-side routing
- **Forms**: React Hook Form with Zod validation

### Backend Architecture
- **Runtime**: Node.js with Express.js framework
- **Language**: TypeScript with ES modules
- **Database ORM**: Drizzle ORM for type-safe database operations
- **Validation**: Zod schemas shared between frontend and backend
- **Development**: Hot reloading with Vite integration in development mode

### Project Structure
- `/client` - React frontend application
- `/server` - Express backend with API routes
- `/shared` - Shared TypeScript schemas and types
- `/migrations` - Database migration files (generated by Drizzle)

## Key Components

### Database Schema
The application uses a relational PostgreSQL database with the following core entities:
- **Projects**: Top-level containers for story worlds
- **Characters**: Character profiles with appearance, personality, background
- **Locations**: Geographical and structural locations with hierarchical relationships
- **Events**: Timeline events with ordering and importance levels
- **Magic Systems**: Supernatural systems with rules and limitations
- **Lore Entries**: World history and cultural information
- **Notes**: Quick notes with categorization and color coding
- **Relationships**: Character relationships and connections

### API Design
RESTful API endpoints following convention:
- `GET /api/projects/:id/[entity]` - List entities for a project
- `GET /api/[entity]/:id` - Get specific entity
- `POST /api/[entity]` - Create new entity
- `PATCH /api/[entity]/:id` - Update entity
- `DELETE /api/[entity]/:id` - Delete entity

### UI Architecture
- **Component Library**: Comprehensive set of reusable UI components (CharacterCard, Button variations, DeleteConfirmation, Navbar)
- **Typography**: Cairo font family with weights 200-900 for consistent visual hierarchy
- **Form Management**: Consistent form patterns with validation
- **Theme System**: Light mode only with custom brand color palette (brand-50 to brand-950)
- **Responsive Design**: Mobile-first approach with Tailwind breakpoints

## Data Flow

1. **Client Requests**: React components use TanStack Query hooks to fetch data
2. **API Layer**: Express routes handle HTTP requests and validate input with Zod
3. **Database Layer**: Drizzle ORM executes type-safe database queries
4. **Response Flow**: Data flows back through the same layers with automatic caching

### State Management Strategy
- **Server State**: TanStack Query manages all server data with automatic caching, background updates, and optimistic updates
- **Client State**: React useState and useContext for local component state
- **Form State**: React Hook Form for form-specific state management

## External Dependencies

### Core Dependencies
- **Database**: Neon Database (PostgreSQL) via `@neondatabase/serverless`
- **UI Components**: Radix UI primitives for accessible components
- **Validation**: Zod for runtime type checking and validation
- **Date Handling**: date-fns for date manipulation and formatting

### Development Dependencies
- **TypeScript**: Full TypeScript support across the stack
- **ESBuild**: Fast bundling for production builds
- **PostCSS**: CSS processing with Tailwind and Autoprefixer

### Database Configuration
- Uses environment variable `DATABASE_URL` for database connection
- Drizzle configured for PostgreSQL dialect with migrations in `/migrations`
- Session storage uses `connect-pg-simple` for PostgreSQL session store

## Deployment Strategy

### Development Mode
- Vite dev server serves the React application with HMR
- Express server runs with `tsx` for TypeScript execution
- Development-specific middleware for error overlays and debugging

### Production Build
- Frontend: Vite builds static assets to `/dist/public`
- Backend: ESBuild bundles server code to `/dist/index.js`
- Static file serving: Express serves built frontend assets in production

### Database Management
- Schema changes managed through Drizzle migrations
- `db:push` command for development schema synchronization
- Environment-based configuration for different deployment stages

### Replit Integration
- Configured for Replit deployment with runtime error handling
- Cartographer plugin for development environment debugging
- Replit-specific vite plugins for enhanced development experience

The architecture prioritizes developer experience with hot reloading, type safety, and modern tooling while maintaining production performance and scalability.

## Recent Changes

### January 2025 - Core Component System
- Implemented custom color palette system (brand-50 to brand-950) replacing default theme
- Created reusable CharacterCard component with image, type icons, badges, and metadata
- Built comprehensive Button component with 6 variants and 4 sizes
- Added DeleteConfirmation modal with backdrop blur and customizable content
- Developed responsive Navbar with conditional navigation based on project state
- Integrated Cairo font family with full weight range (200-900) for typography hierarchy
- Established light-mode-only design system with consistent visual language

### January 2025 - Timeline System Enhancement
- Built serpentine timeline component with visible connecting path using brand colors
- Implemented true responsive timeline with automatic breakpoint detection
- Added useResponsiveTimeline hook for screen size detection and layout adaptation
- Timeline adapts: Mobile (2 events/row, 320px), Tablet (3 events/row, 600px), Desktop (4 events/row, 1000px)
- Fixed container width issues and z-index layering for proper event display
- Added responsive prop to enable/disable automatic responsive behavior
- Supports both responsive mode and fixed-size override mode

### January 2025 - Multi-Event Timeline Functionality
- Implemented multi-event bubble display showing "X Events" for same-date events
- Created simplified multi-event hover popup with clickable individual event cards
- Added intelligent popup positioning to prevent viewport overflow
- Enhanced scroll detection to distinguish between timeline and popup scrolling
- Fixed internal popup scrolling while maintaining timeline scroll-to-close behavior
- Multi-event bubbles use brand-50 background with proper event count display

### January 2025 - Project Workspace Reset
- Cleared all project workspace pages (Dashboard, Characters, Locations, Timeline, Magic Systems, Lore)
- Each page now shows minimal clean template with proper navbar integration
- Maintained project-specific routing structure and project name display
- Ready for fresh content implementation with established component system

### January 2025 - Event Details Page Implementation
- Created comprehensive event details page with grid layout
- Added event header with icon, title, stage badge, type badge, and date badge
- Implemented main content area with event description in prose format
- Built sidebar with location and characters sections using MiniCard components
- Integrated clickable navigation to character and location detail pages
- Added proper routing for `/projects/:projectId/events/:eventId`
- Connected timeline event clicks to navigate to event details
- Applied consistent brand styling and 100px margin layout

### January 2025 - Event Form System Implementation
- Created comprehensive event form component supporting both create and edit modes
- Added dynamic header with real-time icon and color updates based on form selections
- Implemented complete form validation using Zod with event schema
- Built grid-based form layout with event type, stage, location, and date fields
- Integrated location selection dropdown with existing project locations
- Added proper routing for create (`/timeline/new-event`) and edit (`/events/:id/edit`) modes
- Connected edit button on event details page to form
- Added create event buttons to timeline page header and empty state
- Applied consistent brand styling and button variants throughout
- Implemented proper form reset and data loading for edit mode

### January 2025 - Character Management Enhancement
- Updated character management system with full CRUD operations (create, edit, details pages)
- Enhanced character schema with comprehensive fields (prefix, suffix, type, powerType, age, race)
- Standardized back button placement across all character pages following event form pattern
- Changed all back buttons to use "ghost" variant for consistent subtle appearance
- Added missing back button to character details page for complete navigation consistency
- Updated sample character data with complete field information for testing

### January 2025 - Complete Notes Management System
- Created notes page using ContentCard component for consistent display with category-based icons
- Added support for note colors (yellow, blue, green, purple, pink, orange) with visual styling
- Implemented note category system (general, idea, reminder, plot, character, location, research)
- Built comprehensive note details page with clean layout and proper color-coded content display
- Created note creation and editing pages with comprehensive form (content, category, color selection)
- Added complete routing system for all note operations: list, create, edit, details
- Implemented proper navigation flow between all note pages with consistent back button placement
- Fixed query cache invalidation and applied consistent button styling throughout note system
- Connected all note operations with proper API endpoints and error handling
- Applied 100px margin layout and brand styling for consistency with other detail pages

### January 2025 - Complete Location Management System
- Updated location details page styling to match character page design with consistent brand colors
- Removed sidebar layout and made tabs stretch full width as requested
- Switched Characters and Timeline tab order with Timeline now last
- Replaced timeline tab content with full SerpentineTimeline component for visual event display
- Created comprehensive location creation page with form validation and 18+ location types
- Built location editing page with proper data loading and update functionality
- Added complete routing system for all location operations: list, create, edit, details
- Implemented proper navigation flow with ghost variant back buttons throughout
- Fixed background color consistency issues between pages
- Applied consistent form styling and error handling across all location forms
- Integrated location type icons and dynamic form headers based on selected type

### January 2025 - Complete Lore Management System
- Created lore page using ContentCard component for consistent display with category-based icons
- Implemented comprehensive lore category system (history, culture, religion, politics, geography, technology, magic, language)
- Built complete lore details page with category badges, edit button, and formatted content display
- Created lore creation and editing pages with title, category dropdown, and content textarea
- Added full routing system for all lore operations: list, create, edit, details with proper safeguards
- Applied consistent styling matching other management pages with ghost back buttons and brand colors
- Fixed button centering issues in empty states for better visual alignment
- Connected all lore operations with proper API endpoints and cache invalidation

### January 2025 - Complete Magic System Management
- Created magic system creation page with comprehensive form for all system fields
- Built magic system editing page with proper data loading and dynamic header icons
- Added full routing system for magic system operations: list, create, edit, details
- Implemented proper navigation flow with ghost back buttons and consistent styling
- Form includes all schema fields: name, type, description, rules, limitations, source, complexity, users
- Applied dynamic icon system based on magic system type (magic/power) and source category
- Connected create/edit operations with proper API endpoints and cache invalidation
- Used existing MagicSystemForm component for consistent form handling and validation

### January 2025 - Enhanced Magic System Forms with Tabbed Interface
- Implemented tabbed interface for magic system creation and editing forms matching details page structure
- Added comprehensive form sections: Details, Rules, Limitations, Cost & Requirements
- Added cost field to database schema and updated forms to include all missing fields
- Enhanced form organization with four intuitive tabs: Details (BookOpen), Rules (Scroll), Limitations (Shield), Cost (DollarSign)
- Improved user experience with clear separation of concerns and better form navigation
- Updated details page to properly display cost information from database
- Applied consistent tab styling with brand colors and hover states

### January 2025 - Location Form Tabbed Interface Implementation
- Implemented tabbed interface for location creation and editing forms matching details page structure
- Added comprehensive form sections: Overview, Geography, Politics with intuitive icons
- Enhanced form organization with three logical tabs: Overview (MapPin), Geography (Mountain), Politics (Crown)
- Improved user experience with clear field separation and better form navigation
- Updated create and edit pages to use LocationForm component with dynamic headers
- Applied consistent tab styling with brand colors and hover states matching magic system forms
- Enhanced form placeholders with more detailed guidance for each field type

### January 2025 - Complete Spell and Ability Management System
- Implemented complete CRUD functionality for spells (magic systems) and abilities (power systems)
- Created centered content layout for both spell and ability detail pages with consistent styling
- Added edit buttons using primary variant for both spell and ability details
- Built comprehensive SpellForm component with dynamic icons and adaptive content for both spells and abilities
- Implemented spell and ability creation and editing pages with proper form validation
- Added all necessary routes for spell/ability management including creation and editing paths
- Made "Add Spell/Ability" buttons functional in magic system details pages
- Updated system to properly distinguish between only two types: Magic Systems (Sparkles icon) and Power Systems (Zap icon)
- Simplified badge display to show "Magic System" or "Power System" labels instead of complex source-based categorization
- Updated ContentCard component to properly display the two system types with correct labeling

### January 2025 - Migration to Replit Environment
- Successfully migrated StoryForge from Replit Agent to standard Replit environment
- Verified all dependencies and packages are properly installed and configured
- Set up PostgreSQL database with proper environment variables and connection
- Applied database schema using Drizzle migrations successfully
- Confirmed API endpoints are responding correctly and application is fully functional
- Ensured security best practices with proper client/server separation
- Maintained custom brand color palette (brand-50 to brand-950) and Cairo typography system

### January 2025 - Masonry Layout Implementation
- Fixed critical layout width issues by replacing fixed 100px margins with responsive Tailwind classes
- Successfully implemented Masonry.js for ContentCard component to create dynamic brick-style layouts
- Installed masonry-layout package with TypeScript types for proper integration
- Created MasonryGrid and MasonryItem components for reusable masonry functionality
- Updated all ContentCard pages (Locations, Lore, Magic Systems, Notes) with masonry layout
- Eliminated empty space issues caused by CSS grid making all cards the same height as tallest
- Preserved existing 3-column responsive design (1 col mobile, 2 col tablet, 3 col desktop)
- Maintained brand styling, spacing, and hover effects while enabling dynamic height-based positioning
- Cards now stack naturally based on content height without wasted vertical space