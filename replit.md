# StoryForge - Worldbuilding Management Platform

## Overview

StoryForge is a comprehensive worldbuilding and story management platform designed for writers and creators. It provides tools to organize characters, locations, timelines, magic systems, lore, and notes within structured projects. The application uses a modern full-stack architecture with a React frontend and Express backend, leveraging PostgreSQL for data persistence.

## User Preferences

Preferred communication style: Simple, everyday language.
Typography: Cairo font for entire application with full weight range (200-900).
Design approach: Light mode only, custom brand color palette, offline-first architecture.

## System Architecture

### Frontend Architecture
- **Framework**: React 18 with TypeScript
- **Build Tool**: Vite for development and production builds
- **UI Library**: Shadcn/ui components built on Radix UI primitives
- **Styling**: Tailwind CSS with CSS variables for theming
- **State Management**: TanStack Query (React Query) for server state management
- **Routing**: Wouter for lightweight client-side routing
- **Forms**: React Hook Form with Zod validation

### Backend Architecture
- **Runtime**: Node.js with Express.js framework
- **Language**: TypeScript with ES modules
- **Database ORM**: Drizzle ORM for type-safe database operations
- **Validation**: Zod schemas shared between frontend and backend
- **Development**: Hot reloading with Vite integration in development mode

### Project Structure
- `/client` - React frontend application
- `/server` - Express backend with API routes
- `/shared` - Shared TypeScript schemas and types
- `/migrations` - Database migration files (generated by Drizzle)

## Key Components

### Database Schema
The application uses a relational PostgreSQL database with the following core entities:
- **Projects**: Top-level containers for story worlds
- **Characters**: Character profiles with appearance, personality, background
- **Locations**: Geographical and structural locations with hierarchical relationships
- **Events**: Timeline events with ordering and importance levels
- **Magic Systems**: Supernatural systems with rules and limitations
- **Lore Entries**: World history and cultural information
- **Notes**: Quick notes with categorization and color coding
- **Relationships**: Character relationships and connections

### API Design
RESTful API endpoints following convention:
- `GET /api/projects/:id/[entity]` - List entities for a project
- `GET /api/[entity]/:id` - Get specific entity
- `POST /api/[entity]` - Create new entity
- `PATCH /api/[entity]/:id` - Update entity
- `DELETE /api/[entity]/:id` - Delete entity

### UI Architecture
- **Component Library**: Comprehensive set of reusable UI components (CharacterCard, Button variations, DeleteConfirmation, Navbar)
- **Typography**: Cairo font family with weights 200-900 for consistent visual hierarchy
- **Form Management**: Consistent form patterns with validation
- **Theme System**: Light mode only with custom brand color palette (brand-50 to brand-950)
- **Responsive Design**: Mobile-first approach with Tailwind breakpoints

## Data Flow

1. **Client Requests**: React components use TanStack Query hooks to fetch data
2. **API Layer**: Express routes handle HTTP requests and validate input with Zod
3. **Database Layer**: Drizzle ORM executes type-safe database queries
4. **Response Flow**: Data flows back through the same layers with automatic caching

### State Management Strategy
- **Server State**: TanStack Query manages all server data with automatic caching, background updates, and optimistic updates
- **Client State**: React useState and useContext for local component state
- **Form State**: React Hook Form for form-specific state management

## External Dependencies

### Core Dependencies
- **Database**: PostgreSQL (currently Neon, planned migration to Supabase)
- **Image Storage**: Local file system (planned migration to Supabase Storage)
- **UI Components**: Radix UI primitives for accessible components
- **Validation**: Zod for runtime type checking and validation
- **Date Handling**: date-fns for date manipulation and formatting

### Development Dependencies
- **TypeScript**: Full TypeScript support across the stack
- **ESBuild**: Fast bundling for production builds
- **PostCSS**: CSS processing with Tailwind and Autoprefixer

### Database Configuration
- Uses environment variable `DATABASE_URL` for database connection
- Drizzle configured for PostgreSQL dialect with migrations in `/migrations`
- Session storage uses `connect-pg-simple` for PostgreSQL session store

## Deployment Strategy

### Development Mode
- Vite dev server serves the React application with HMR
- Express server runs with `tsx` for TypeScript execution
- Development-specific middleware for error overlays and debugging

### Production Build
- Frontend: Vite builds static assets to `/dist/public`
- Backend: ESBuild bundles server code to `/dist/index.js`
- Static file serving: Express serves built frontend assets in production

### Database Management
- Schema changes managed through Drizzle migrations
- `db:push` command for development schema synchronization
- Environment-based configuration for different deployment stages

### Replit Integration
- Configured for Replit deployment with runtime error handling
- Cartographer plugin for development environment debugging
- Replit-specific vite plugins for enhanced development experience

The architecture prioritizes developer experience with hot reloading, type safety, and modern tooling while maintaining production performance and scalability.

## Recent Changes

### January 2025 - Core Component System
- Implemented custom color palette system (brand-50 to brand-950) replacing default theme
- Created reusable CharacterCard component with image, type icons, badges, and metadata
- Built comprehensive Button component with 6 variants and 4 sizes
- Added DeleteConfirmation modal with backdrop blur and customizable content
- Developed responsive Navbar with conditional navigation based on project state
- Integrated Cairo font family with full weight range (200-900) for typography hierarchy
- Established light-mode-only design system with consistent visual language

### January 2025 - Timeline System Enhancement
- Built serpentine timeline component with visible connecting path using brand colors
- Implemented true responsive timeline with automatic breakpoint detection
- Added useResponsiveTimeline hook for screen size detection and layout adaptation
- Timeline adapts: Mobile (2 events/row, 320px), Tablet (3 events/row, 600px), Desktop (4 events/row, 1000px)
- Fixed container width issues and z-index layering for proper event display
- Added responsive prop to enable/disable automatic responsive behavior
- Supports both responsive mode and fixed-size override mode

### January 2025 - Multi-Event Timeline Functionality
- Implemented multi-event bubble display showing "X Events" for same-date events
- Created simplified multi-event hover popup with clickable individual event cards
- Added intelligent popup positioning to prevent viewport overflow
- Enhanced scroll detection to distinguish between timeline and popup scrolling
- Fixed internal popup scrolling while maintaining timeline scroll-to-close behavior
- Multi-event bubbles use brand-50 background with proper event count display

### January 2025 - Project Workspace Reset
- Cleared all project workspace pages (Dashboard, Characters, Locations, Timeline, Magic Systems, Lore)
- Each page now shows minimal clean template with proper navbar integration
- Maintained project-specific routing structure and project name display
- Ready for fresh content implementation with established component system

### January 2025 - Event Details Page Implementation
- Created comprehensive event details page with grid layout
- Added event header with icon, title, stage badge, type badge, and date badge
- Implemented main content area with event description in prose format
- Built sidebar with location and characters sections using MiniCard components
- Integrated clickable navigation to character and location detail pages
- Added proper routing for `/projects/:projectId/events/:eventId`
- Connected timeline event clicks to navigate to event details
- Applied consistent brand styling and 100px margin layout

### January 2025 - Event Form System Implementation
- Created comprehensive event form component supporting both create and edit modes
- Added dynamic header with real-time icon and color updates based on form selections
- Implemented complete form validation using Zod with event schema
- Built grid-based form layout with event type, stage, location, and date fields
- Integrated location selection dropdown with existing project locations
- Added proper routing for create (`/timeline/new-event`) and edit (`/events/:id/edit`) modes
- Connected edit button on event details page to form
- Added create event buttons to timeline page header and empty state
- Applied consistent brand styling and button variants throughout
- Implemented proper form reset and data loading for edit mode

### January 2025 - Character Management Enhancement
- Updated character management system with full CRUD operations (create, edit, details pages)
- Enhanced character schema with comprehensive fields (prefix, suffix, type, powerType, age, race)
- Standardized back button placement across all character pages following event form pattern
- Changed all back buttons to use "ghost" variant for consistent subtle appearance
- Added missing back button to character details page for complete navigation consistency
- Updated sample character data with complete field information for testing

### January 2025 - Complete Notes Management System
- Created notes page using ContentCard component for consistent display with category-based icons
- Added support for note colors (yellow, blue, green, purple, pink, orange) with visual styling
- Implemented note category system (general, idea, reminder, plot, character, location, research)
- Built comprehensive note details page with clean layout and proper color-coded content display
- Created note creation and editing pages with comprehensive form (content, category, color selection)
- Added complete routing system for all note operations: list, create, edit, details
- Implemented proper navigation flow between all note pages with consistent back button placement
- Fixed query cache invalidation and applied consistent button styling throughout note system
- Connected all note operations with proper API endpoints and error handling
- Applied 100px margin layout and brand styling for consistency with other detail pages

### January 2025 - Complete Location Management System
- Updated location details page styling to match character page design with consistent brand colors
- Removed sidebar layout and made tabs stretch full width as requested
- Switched Characters and Timeline tab order with Timeline now last
- Replaced timeline tab content with full SerpentineTimeline component for visual event display
- Created comprehensive location creation page with form validation and 18+ location types
- Built location editing page with proper data loading and update functionality
- Added complete routing system for all location operations: list, create, edit, details
- Implemented proper navigation flow with ghost variant back buttons throughout
- Fixed background color consistency issues between pages
- Applied consistent form styling and error handling across all location forms
- Integrated location type icons and dynamic form headers based on selected type

### January 2025 - Complete Lore Management System
- Created lore page using ContentCard component for consistent display with category-based icons
- Implemented comprehensive lore category system (history, culture, religion, politics, geography, technology, magic, language)
- Built complete lore details page with category badges, edit button, and formatted content display
- Created lore creation and editing pages with title, category dropdown, and content textarea
- Added full routing system for all lore operations: list, create, edit, details with proper safeguards
- Applied consistent styling matching other management pages with ghost back buttons and brand colors
- Fixed button centering issues in empty states for better visual alignment
- Connected all lore operations with proper API endpoints and cache invalidation

### January 2025 - Complete Magic System Management
- Created magic system creation page with comprehensive form for all system fields
- Built magic system editing page with proper data loading and dynamic header icons
- Added full routing system for magic system operations: list, create, edit, details
- Implemented proper navigation flow with ghost back buttons and consistent styling
- Form includes all schema fields: name, type, description, rules, limitations, source, complexity, users
- Applied dynamic icon system based on magic system type (magic/power) and source category
- Connected create/edit operations with proper API endpoints and cache invalidation
- Used existing MagicSystemForm component for consistent form handling and validation

### January 2025 - Enhanced Magic System Forms with Tabbed Interface
- Implemented tabbed interface for magic system creation and editing forms matching details page structure
- Added comprehensive form sections: Details, Rules, Limitations, Cost & Requirements
- Added cost field to database schema and updated forms to include all missing fields
- Enhanced form organization with four intuitive tabs: Details (BookOpen), Rules (Scroll), Limitations (Shield), Cost (DollarSign)
- Improved user experience with clear separation of concerns and better form navigation
- Updated details page to properly display cost information from database
- Applied consistent tab styling with brand colors and hover states

### January 2025 - Location Form Tabbed Interface Implementation
- Implemented tabbed interface for location creation and editing forms matching details page structure
- Added comprehensive form sections: Overview, Geography, Politics with intuitive icons
- Enhanced form organization with three logical tabs: Overview (MapPin), Geography (Mountain), Politics (Crown)
- Improved user experience with clear field separation and better form navigation
- Updated create and edit pages to use LocationForm component with dynamic headers
- Applied consistent tab styling with brand colors and hover states matching magic system forms
- Enhanced form placeholders with more detailed guidance for each field type

### January 2025 - Complete Spell and Ability Management System
- Implemented complete CRUD functionality for spells (magic systems) and abilities (power systems)
- Created centered content layout for both spell and ability detail pages with consistent styling
- Added edit buttons using primary variant for both spell and ability details
- Built comprehensive SpellForm component with dynamic icons and adaptive content for both spells and abilities
- Implemented spell and ability creation and editing pages with proper form validation
- Added all necessary routes for spell/ability management including creation and editing paths
- Made "Add Spell/Ability" buttons functional in magic system details pages
- Updated system to properly distinguish between only two types: Magic Systems (Sparkles icon) and Power Systems (Zap icon)
- Simplified badge display to show "Magic System" or "Power System" labels instead of complex source-based categorization
- Updated ContentCard component to properly display the two system types with correct labeling

### January 2025 - Migration to Replit Environment
- Successfully migrated StoryForge from Replit Agent to standard Replit environment
- Verified all dependencies and packages are properly installed and configured
- Set up PostgreSQL database with proper environment variables and connection
- Applied database schema using Drizzle migrations successfully
- Confirmed API endpoints are responding correctly and application is fully functional
- Ensured security best practices with proper client/server separation
- Maintained custom brand color palette (brand-50 to brand-950) and Cairo typography system

### January 2025 - Complete Navigation System and Page Title Standardization
- Fixed CharacterMagicCard component to use centralized referrer navigation system instead of callback functions
- Resolved all navigation back button issues throughout the application
- Implemented comprehensive page title management across all pages using document.title
- Added consistent title format: "Page Name - Project Name | StoryForge" for project pages
- Added specific title format for detail pages: "Item Name - Project Name | StoryForge"
- Welcome page uses: "StoryForge - Worldbuilding Management Platform"
- All browser tab titles now accurately match page content and provide proper context
- Navigation system now fully implemented app-wide with referrer tracking working correctly

### January 2025 - Race Management System Completion and Routing Fixes
- Successfully completed race management system with full CRUD operations
- Created RaceDetails, RaceForm, CreateRace, and EditRace pages with proper validation
- Enhanced MiniCard component with new "dropdown" variant featuring three dots menu for edit/delete actions
- Fixed critical routing issues by removing catch-all NotFound route that was causing overlay problems
- Added missing route for races main page (`/projects/:projectId/races`) to prevent routing conflicts
- Fixed race creation form to prevent invalid API calls to `/api/races/new`
- Resolved "Race Not Found" error appearing inappropriately during race creation
- Updated race details component to properly handle "new" race ID parameter
- Applied consistent navigation patterns and ghost button styling throughout race management
- Race creation now properly navigates to race details page after successful creation

### January 2025 - Race Details Tabbed Interface and Schema Cleanup
- Converted race details page to tabbed interface matching location details page design exactly
- Implemented race header with icon, badge, and action buttons (Edit/Delete) matching location pattern
- Updated background colors, spacing, and layout hierarchy to perfectly match location details
- Added delete button with confirmation dialog functionality
- Updated tab navigation styling to match location details (space-x-8, proper borders)
- Changed tab content background to bg-brand-50 with border for consistency
- Removed biology field from races schema as it was redundant with other existing fields
- Updated race form to use tabbed interface with 3 logical sections: Basic Info, Culture & Society, Traits & Abilities
- Applied consistent styling and full-width tab layout for better organization
- Database schema successfully updated to remove unnecessary biology column
- Forms now properly organized with enhanced placeholders and better field grouping

### January 2025 - Race Characters Tab Integration
- Added Characters tab to race details page showing all characters of that race
- Integrated CharacterCard component to display characters in responsive grid layout
- Added character filtering logic to match race names with character race field
- Implemented character click navigation to character details with proper referrer tracking
- Added empty state for races with no characters with helpful creation guidance
- Enhanced tab structure with 6 total tabs including the new Characters tab

### January 2025 - Race Form Pages Redesign
- Completely rewrote race create and edit pages to match race details page design exactly
- Replaced old RaceForm component with individual CreateRace and EditRace pages
- Applied consistent layout: bg-background, separate back button section, race header with icon and badge
- Implemented tabbed form interface matching details page: Basic Info, Culture & Society, Traits & Abilities
- Used same tab navigation styling (space-x-8, border styling) and tab content (bg-brand-50 with border)
- Added proper form validation using insertRaceSchema and React Hook Form
- Applied consistent text colors (brand-950 for headings, brand-900 for labels)
- Enhanced form fields with appropriate placeholders and textarea sizing
- Added loading and error states matching other pages
- Integrated proper navigation and mutation handling with cache invalidation

### January 2025 - WordProcessor Component Implementation
- Created clean WordProcessor component using Editor.js with minimal base styling
- Added image upload capability with /api/upload-image and /api/upload-image-by-url endpoints
- Implemented responsive design with CSS adjustments for mobile, tablet, and desktop
- Fixed left spacing issues and made component fully responsive for multiple container sizes
- Added comprehensive rich text features: headers, lists, quotes, code blocks, tables, images, links
- Component available in components showcase at /components route
- Uses standard Editor.js appearance without custom StoryForge styling per user preference
- Image upload currently uses local file system storage, planned migration to Supabase Storage for production
- Created EditorContentRenderer component for displaying saved Editor.js content on details pages
- Applied consistent brand styling (brand-950, brand-900) to rendered content with proper typography hierarchy

### January 2025 - Event Form Redesign to Match Details Page Layout
- Completely redesigned event create and edit forms to mirror the event details page structure
- Implemented header layout with large title input field and inline badge selectors for stage, type, and date
- Created main content grid with 2/3 description area and 1/3 sidebar matching details page
- Added inline date picker with calendar icon matching the details page badge style
- Moved location and characters to right sidebar with preview cards when selected
- Applied consistent brand-50 backgrounds and rounded containers throughout
- Enhanced user experience with real-time preview of selected location and characters
- Maintained all form validation and submission functionality while improving visual consistency

### January 2025 - Event Form Comprehensive Improvements
- Fixed title input to use proper Input component with transparent styling and full visibility
- Redesigned date inputs to use proper Input components with individual validation and cleaner layout
- Added support for multiple locations with primary/additional location labeling system
- Ensured all dropdowns use consistent Select component styling from components folder
- Moved save/cancel buttons to top-right header matching details page action button placement
- Simplified edit event page title to reduce visual clutter and improve readability
- Enhanced form UX with proper focus states, error handling, and responsive design
- Implemented proper form ID linking for external submit button functionality

### January 2025 - Layout Spacing and Container Improvements
- Expanded event form container from max-w-4xl to max-w-6xl for better content distribution
- Increased main content grid gap from 8 to 12 for better visual separation
- Enhanced container padding from p-6 to p-8 across all content sections for more breathing room
- Simplified responsive padding classes removing complex sm:px-6 lg:px-8 in favor of consistent px-8
- Applied consistent spacing improvements across timeline, event details, and location pages
- Updated "complete" status color from brand-950 (near black) to brand-700 for better brand consistency

### January 2025 - Race Management System Optimization and Schema Cleanup
- Streamlined races database schema by removing specialTraits field for cleaner interface
- Updated race create and edit forms to match event form structure with proper WordProcessor integration
- Applied consistent container styling with bg-brand-50 rounded-xl backgrounds for proper visual hierarchy
- Organized sidebar with 4 logical sections: Homeland, Physical Characteristics, Abilities & Powers, Characters
- Enhanced homeland selection with proper location foreign key relationships
- Maintained magical affinity system while removing redundant special traits dropdown
- Fixed WordProcessor display issues by applying proper container backgrounds
- Characters section now appears in sidebar with proper MiniCard components using dropdown variant for remove functionality
- Applied event-form-style layout with 2/3 main content + 1/3 sidebar grid structure
- Enhanced form validation and error handling with proper React Hook Form integration
- Race management now provides clean, focused interface optimized for essential race information
- Updated race details page to match edit/create page design with 2/3 main content + 1/3 sidebar grid layout
- Enhanced description section to use EditorContentRenderer for proper rich text display from WordProcessor
- Organized sidebar with 4 sections: Homeland (with MiniCard), Physical Characteristics, Abilities & Powers, Characters
- Applied consistent styling with bg-brand-50 containers and proper spacing throughout race details page

### January 2025 - Expanded Race Schema and Database Relationship Fix
- Enhanced race database schema with comprehensive race properties: homelandId, lifespan, sizeCategory, magicalAffinity, specialTraits
- Fixed critical database relationship by replacing text-based race field in characters table with proper foreign key reference (raceId)
- Added homeland selection linking races to locations table for proper geographical relationships
- Implemented physical characteristics options: lifespan (5 levels from short to immortal), size categories (tiny to huge)
- Added magical abilities system: 5 affinity levels from none to innate magic powers
- Included special traits selection: enhanced senses, flight, shapeshifting, telepathy, elemental control, regeneration
- Updated both race creation and editing forms with functional dropdowns for all new properties
- Connected character filtering to use proper race ID relationships instead of name matching
- Applied database schema migration with proper foreign key constraints and referential integrity

### January 2025 - Complete Replit Environment Migration and UI Fixes
- Successfully completed migration from Replit Agent to standard Replit environment
- Verified all dependencies and packages properly installed and functional
- Confirmed PostgreSQL database connectivity and API endpoints working correctly
- Fixed branding consistency by updating navbar title from "InkAlchemy" to "StoryForge"
- Updated navbar subtitle to "Worldbuilding Management Platform" matching project purpose
- Fixed race details page icon from inappropriate UserCheck to proper Users icon with brand-500 background
- Applied consistent color scheme for race header icon matching character details pattern
- All race-related UI components now use Users icon for visual consistency
- Migration completed with full functionality preserved and UI improvements applied

### January 2025 - Character Management System Redesign and Schema Alignment
- Redesigned character details page layout: moved tabs to left (2/3 width), character info to right sidebar (1/3 width)
- Removed appearance, backstory, and weapons tabs per user request, kept only details, magic & abilities, and timeline
- Fixed race data fetching to use proper raceId foreign key relationship instead of deprecated text field
- Updated race management pages (create/edit) to use Users icon with brand-500 background matching details page
- Enhanced character details tab to display all available schema fields: description, personality, background, goals, appearance, role, powerType, weapons, equipment, and status
- Added proper conditional rendering with organized sections and visual hierarchy using brand color system
- Applied responsive grid layouts for role/powerType and weapons/equipment sections with brand-100 background cards
- Character details page now fully utilizes all available database fields providing comprehensive character information display

### January 2025 - Character Form Layout Redesign and Container Width Standardization
- Switched character edit and create form layout: tabs section moved to left (2/3 width), character profile to right sidebar (1/3 width)
- Recreated CharacterForm component with clean tabbed interface maintaining all existing functionality
- Updated container width on edit/create pages from max-w-4xl to max-w-7xl matching character details page for consistent wide layout
- Applied responsive padding (px-4 sm:px-6 lg:px-8) to match details page relaxed margins and spacing
- Updated tab structure to match character details page: only "Details" and "Magic & Abilities" tabs (removed timeline)
- Reorganized form content into logical sections within Details tab: Basic Information, Character Background, Physical & Role Details, Equipment & Combat
- Fixed all TypeScript errors with proper null handling using normalizeCharacterData helper function
- Updated race field to use proper raceId dropdown instead of text-based race field with database foreign key relationship